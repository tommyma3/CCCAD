include: config/model/ad_base.yaml

model: CompressedAD

# AD Transformer
tf_n_embd: 64
tf_n_layer: 4
tf_n_head: 4
tf_dropout: 0.1
tf_attn_dropout: 0.1
tf_n_inner: 128
n_transit: 240  

# Compression Settings
n_compress_tokens: 40
compress_n_layers: 2
compress_n_heads: 4

# Gradient control for stability
max_gradient_rounds: 2  # Detach gradients after this many compression rounds

# Reconstruction regularization during fine-tuning
use_recon_reg: True
recon_reg_weight: 0.1

# Curriculum settings (None = unlimited)
max_compressions: null

# Dataset settings for variable-length training
min_context_length: 50
max_context_length: 800

# Training
lr: 0.0003  
train_batch_size: 256  # Smaller batch for longer sequences
test_batch_size: 512
train_source_timesteps: 1000
train_timesteps: 50000
num_warmup_steps: 1000  

num_workers: 4
